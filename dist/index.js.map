{"version":3,"file":"index.js","names":["_path","require","_core","_pluginSyntaxJsx","_interopRequireDefault","_types","_ajv","_ajvKeywords","_attributeNameExists","_createObjectExpression","_createSpreadMapper","_handleSpreadClassName","_replaceJsxExpressionContainer","_requireCssModule","_resolveStringLiteral","_optionsDefaults","_optionsSchema","e","__esModule","default","ajv","Ajv","$data","ajvKeywords","validate","compile","optionsSchema","getTargetResourcePath","importedPath","stats","targetFileDirectoryPath","dirname","file","opts","filename","startsWith","resolve","isFilenameExcluded","exclude","match","RegExp","notForPlugin","extension","lastIndexOf","slice","filetypes","_default","types","styleMapsForFileByName","styleMapsForFileByPath","skip","setupFileForRuntimeResolution","path","programPath","findParent","parentPath","isProgram","importedHelperIndentifier","scope","generateUidIdentifier","styleModuleImportMapIdentifier","unshiftContainer","importDeclaration","importDefaultSpecifier","stringLiteral","firstNonImportDeclarationNode","get","find","node","isImportDeclaration","insertBefore","variableDeclaration","variableDeclarator","cloneNode","createObjectExpression","styleModuleImportMap","addCommonJsWebpackHotModuleAccept","test","memberExpression","identifier","consequent","blockStatement","expressionStatement","callExpression","functionExpression","hotAcceptStatement","ifStatement","pushContainer","addEsmWebpackHotModuleAccept","loadStyleMap","name","resolvedPath","context","generateScopedName","transform","mapsByName","styleMap","requireCssModule","replaceImport","webpackHotModuleReloading","inherits","babelPluginJsxSyntax","visitor","CallExpression","callee","calleeName","arguments","args","length","isStringLiteral","value","targetResourcePath","isAssigned","type","styleImportName","id","replaceWith","remove","removeImport","ImportDeclaration","source","specifiers","guardStyleImportNameIsNotSet","console","warn","Error","i","specifier","local","undefined","variables","push","imported","JSXElement","attributeNames","optionsDefaults","attributes","openingElement","filter","attribute","handleMissingStyleName","autoResolveMultipleImports","spreadMap","createSpreadMapper","forEach","destinationName","options","resolveStringLiteral","isJSXExpressionContainer","replaceJsxExpressionContainer","handleSpreadClassName","Program","error","errors","attributeNameExists","exports"],"sources":["../src/index.js"],"sourcesContent":["// @flow\n\nimport {\n  dirname,\n  resolve,\n} from 'path';\n\nimport { NodePath } from '@babel/core';\n\nimport babelPluginJsxSyntax from '@babel/plugin-syntax-jsx';\nimport BabelTypes from '@babel/types';\nimport Ajv from 'ajv';\nimport ajvKeywords from 'ajv-keywords';\nimport attributeNameExists from './attributeNameExists';\nimport createObjectExpression from './createObjectExpression';\nimport createSpreadMapper from './createSpreadMapper';\nimport handleSpreadClassName from './handleSpreadClassName';\nimport replaceJsxExpressionContainer from './replaceJsxExpressionContainer';\nimport requireCssModule from './requireCssModule';\nimport resolveStringLiteral from './resolveStringLiteral';\nimport optionsDefaults from './schemas/optionsDefaults';\nimport optionsSchema from './schemas/optionsSchema.json';\n\nconst ajv = new Ajv({\n  $data: true,\n});\n\najvKeywords(ajv);\n\nconst validate = ajv.compile(optionsSchema);\n\nconst getTargetResourcePath = (importedPath: string, stats: any) => {\n  const targetFileDirectoryPath = dirname(stats.file.opts.filename);\n\n  if (importedPath.startsWith('.')) {\n    return resolve(targetFileDirectoryPath, importedPath);\n  }\n\n  return require.resolve(importedPath);\n};\n\nconst isFilenameExcluded = (filename: string, exclude: string) => filename.match(new RegExp(exclude, 'u'));\n\nconst notForPlugin = (importedPath: string, stats: any) => {\n  const extension = importedPath.lastIndexOf('.') > -1\n    ? importedPath.slice(importedPath.lastIndexOf('.')) : null;\n\n  if (extension !== '.css') {\n    const { filetypes } = stats.opts;\n    if (!filetypes || !filetypes[extension]) return true;\n  }\n\n  const filename = getTargetResourcePath(importedPath, stats);\n\n  if (stats.opts.exclude && isFilenameExcluded(filename, stats.opts.exclude)) {\n    return true;\n  }\n\n  return false;\n};\n\nexport default ({\n  types,\n}: {|\n  types: typeof BabelTypes,\n|}): { ... } => {\n  const styleMapsForFileByName: { [string]: any } = {};\n  const styleMapsForFileByPath = {};\n\n  let skip = false;\n\n  const setupFileForRuntimeResolution = (path: typeof NodePath, filename: string) => {\n    const programPath = path.findParent((parentPath) => parentPath.isProgram());\n\n    styleMapsForFileByName[filename].importedHelperIndentifier = programPath.scope.generateUidIdentifier('getClassName');\n    styleMapsForFileByName[filename].styleModuleImportMapIdentifier = programPath.scope.generateUidIdentifier('styleModuleImportMap');\n\n    programPath.unshiftContainer(\n      'body',\n      types.importDeclaration(\n        [\n          types.importDefaultSpecifier(\n            styleMapsForFileByName[filename].importedHelperIndentifier,\n          ),\n        ],\n        types.stringLiteral('@dr.pogodin/babel-plugin-react-css-modules/dist/browser/getClassName.js'),\n      ),\n    );\n\n    const firstNonImportDeclarationNode = programPath.get('body').find((node) => !types.isImportDeclaration(node));\n\n    firstNonImportDeclarationNode.insertBefore(\n      types.variableDeclaration(\n        'const',\n        [\n          types.variableDeclarator(\n            types.cloneNode(\n              styleMapsForFileByName[filename].styleModuleImportMapIdentifier,\n            ),\n            createObjectExpression(types, styleMapsForFileByName[filename].styleModuleImportMap),\n          ),\n        ],\n      ),\n    );\n  };\n\n  /**\n   * Adds Webpack \"hot module accept\" code \"a-la CommonJS\" style,\n   * i.e. using module.hot.\n   * @param {object} path\n   */\n  const addCommonJsWebpackHotModuleAccept = (path: typeof NodePath, importedPath: string) => {\n    const test = types.memberExpression(types.identifier('module'), types.identifier('hot'));\n    const consequent = types.blockStatement([\n      types.expressionStatement(\n        types.callExpression(\n          types.memberExpression(\n            types.memberExpression(types.identifier('module'), types.identifier('hot')),\n            types.identifier('accept'),\n          ),\n          [\n            types.stringLiteral(importedPath),\n            types.functionExpression(null, [], types.blockStatement([\n              types.expressionStatement(\n                types.callExpression(\n                  types.identifier('require'),\n                  [types.stringLiteral(importedPath)],\n                ),\n              ),\n            ])),\n          ],\n        ),\n      ),\n    ]);\n\n    const programPath = path.findParent((parentPath) => parentPath.isProgram());\n\n    const firstNonImportDeclarationNode = programPath.get('body').find((node) => !types.isImportDeclaration(node));\n\n    const hotAcceptStatement = types.ifStatement(test, consequent);\n\n    if (firstNonImportDeclarationNode) {\n      firstNonImportDeclarationNode.insertBefore(hotAcceptStatement);\n    } else {\n      programPath.pushContainer('body', hotAcceptStatement);\n    }\n  };\n\n  /**\n   * Adds Webpack \"hot module accept\" code \"a-la ESM\" style,\n   * i.e. using import.meta.webpackHot\n   * @param {object} path\n   */\n  const addEsmWebpackHotModuleAccept = (path: typeof NodePath, importedPath: string) => {\n    const test = types.memberExpression(\n      types.memberExpression(\n        types.identifier('import'),\n        types.identifier('meta'),\n      ),\n      types.identifier('webpackHot'),\n    );\n    const consequent = types.blockStatement([\n      types.expressionStatement(\n        types.callExpression(\n          types.memberExpression(\n            types.memberExpression(\n              types.memberExpression(\n                types.identifier('import'),\n                types.identifier('meta'),\n              ),\n              types.identifier('webpackHot'),\n            ),\n            types.identifier('accept'),\n          ),\n          [\n            types.stringLiteral(importedPath),\n            types.functionExpression(null, [], types.blockStatement([\n              types.expressionStatement(\n                types.callExpression(\n                  types.identifier('require'),\n                  [types.stringLiteral(importedPath)],\n                ),\n              ),\n            ])),\n          ],\n        ),\n      ),\n    ]);\n\n    const programPath = path.findParent((parentPath) => parentPath.isProgram());\n\n    const firstNonImportDeclarationNode = programPath.get('body').find((node) => !types.isImportDeclaration(node));\n\n    const hotAcceptStatement = types.ifStatement(test, consequent);\n\n    if (firstNonImportDeclarationNode) {\n      firstNonImportDeclarationNode.insertBefore(hotAcceptStatement);\n    } else {\n      programPath.pushContainer('body', hotAcceptStatement);\n    }\n  };\n\n  const loadStyleMap = (\n    name: string,\n    importedPath: string,\n    resolvedPath: string,\n    path: typeof NodePath,\n    stats: any,\n  ) => {\n    const {\n      file: { opts: { filename } },\n      opts: {\n        context,\n        filetypes = {},\n        generateScopedName,\n        transform,\n      },\n    } = stats;\n\n    const mapsByName = styleMapsForFileByName[filename].styleModuleImportMap;\n    let styleMap = mapsByName[name];\n\n    // In case it was loaded under a different name before.\n    if (!styleMap) {\n      styleMap = styleMapsForFileByPath[filename][importedPath];\n      mapsByName[name] = styleMap;\n    }\n\n    // Loading a map for the first time.\n    if (!styleMap) {\n      styleMap = requireCssModule(resolvedPath, {\n        context,\n        filetypes,\n        generateScopedName,\n        transform,\n      });\n      mapsByName[name] = styleMap;\n      styleMapsForFileByPath[filename][importedPath] = styleMap;\n\n      const { replaceImport, webpackHotModuleReloading } = stats.opts;\n\n      // replaceImport flag means we target server-side environment,\n      // thus client-side Webpack's HMR code should not be injected.\n      if (!replaceImport) {\n        if (webpackHotModuleReloading === 'commonjs') {\n          addCommonJsWebpackHotModuleAccept(path, importedPath);\n        } else if (webpackHotModuleReloading) {\n          addEsmWebpackHotModuleAccept(path, importedPath);\n        }\n      }\n    }\n\n    return styleMap;\n  };\n\n  return {\n    inherits: babelPluginJsxSyntax,\n    visitor: {\n      // const styles = require('./styles.css');\n      CallExpression(path: typeof NodePath, stats: any): void {\n        const { callee: { name: calleeName }, arguments: args } = path.node;\n        if (skip || calleeName !== 'require' || !args.length\n          || !types.isStringLiteral(args[0])) return;\n\n        const importedPath = args[0].value;\n        if (notForPlugin(importedPath, stats)) return;\n\n        const targetResourcePath = getTargetResourcePath(importedPath, stats);\n\n        const isAssigned = path.parentPath.type === 'VariableDeclarator';\n        const styleImportName: string = isAssigned\n          ? path.parentPath.node.id.name : importedPath;\n\n        const styleMap = loadStyleMap(\n          styleImportName,\n          importedPath,\n          targetResourcePath,\n          path,\n          stats,\n        );\n\n        if (stats.opts.replaceImport) {\n          if (isAssigned) {\n            path.replaceWith(\n              createObjectExpression(types, styleMap),\n            );\n          } else path.remove();\n        } else if (stats.opts.removeImport) {\n          path.remove();\n        }\n      },\n\n      // All these are supposed to be supported by this visitor:\n      // import styles from './style.css';\n      // import * as styles from './style.css';\n      // import { className } from './style.css';\n      // import Style, { className } from './style.css';\n      ImportDeclaration(path: typeof NodePath, stats: any): void {\n        const importedPath = path.node.source.value;\n        if (skip || notForPlugin(importedPath, stats)) return;\n\n        const targetResourcePath = getTargetResourcePath(importedPath, stats);\n\n        let styleImportName: string;\n        const { specifiers } = path.node;\n\n        const guardStyleImportNameIsNotSet = () => {\n          if (styleImportName) {\n            // If this throws, it means we are missing something in our logic\n            // below, and although it might look functional, it does not produce\n            // determenistic style import selection.\n            console.warn('Please report your use case. https://github.com/birdofpreyru/babel-plugin-react-css-modules/issues/new?title=Unexpected+use+case.');\n            throw Error('Style import name is already selected');\n          }\n        };\n\n        for (let i = 0; i < specifiers.length; ++i) {\n          const specifier = specifiers[i];\n          switch (specifier.type) {\n            // import Style from './style.css';\n            case 'ImportDefaultSpecifier':\n              guardStyleImportNameIsNotSet();\n              styleImportName = specifier.local.name;\n              break;\n\n            // import * as Style from './style.css';\n            case 'ImportNamespaceSpecifier':\n              guardStyleImportNameIsNotSet();\n              styleImportName = specifier.local.name;\n              break;\n\n            // These are individual class names in the named import:\n            // import { className } from './style.css';\n            // we just ignore them, falling back to either the default\n            // import, or the imported path.\n            case 'ImportSpecifier':\n              break;\n\n            default:\n              // eslint-disable-next-line no-console\n              console.warn('Please report your use case. https://github.com/birdofpreyru/babel-plugin-react-css-modules/issues/new?title=Unexpected+use+case.');\n\n              throw new Error('Unexpected use case.');\n          }\n        }\n\n        // Fallback for anonymous style import:\n        // import './style.css';\n        if (styleImportName === undefined) styleImportName = importedPath;\n\n        const styleMap = loadStyleMap(\n          styleImportName,\n          importedPath,\n          targetResourcePath,\n          path,\n          stats,\n        );\n\n        if (stats.opts.replaceImport) {\n          const variables = [];\n\n          for (let i = 0; i < specifiers.length; ++i) {\n            const specifier = specifiers[i];\n            switch (specifier.type) {\n              case 'ImportDefaultSpecifier':\n              case 'ImportNamespaceSpecifier':\n                variables.push(\n                  types.variableDeclarator(\n                    types.identifier(specifier.local.name),\n                    createObjectExpression(types, styleMap),\n                  ),\n                );\n                break;\n              case 'ImportSpecifier': {\n                const value = styleMap[specifier.imported.name];\n                variables.push(\n                  types.variableDeclarator(\n                    types.identifier(specifier.local.name),\n                    value === undefined ? undefined : types.stringLiteral(value),\n                  ),\n                );\n                break;\n              }\n              default:\n                throw Error('Unsupported kind of import');\n            }\n          }\n\n          if (variables.length) {\n            path.replaceWith(\n              types.variableDeclaration('const', variables),\n            );\n          } else path.remove();\n        } else if (stats.opts.removeImport) {\n          path.remove();\n        }\n      },\n\n      JSXElement(path: typeof NodePath, stats: any): void {\n        if (skip) {\n          return;\n        }\n\n        const { filename } = stats.file.opts;\n\n        if (stats.opts.exclude && isFilenameExcluded(filename, stats.opts.exclude)) {\n          return;\n        }\n\n        let { attributeNames } = optionsDefaults;\n\n        if (stats.opts && stats.opts.attributeNames) {\n          attributeNames = { ...attributeNames, ...stats.opts.attributeNames };\n        }\n\n        const attributes = path.node.openingElement.attributes\n          .filter((attribute) => typeof attribute.name !== 'undefined' && typeof attributeNames[attribute.name.name] === 'string');\n\n        if (attributes.length === 0) {\n          return;\n        }\n\n        const {\n          handleMissingStyleName = optionsDefaults.handleMissingStyleName,\n          autoResolveMultipleImports = optionsDefaults.autoResolveMultipleImports,\n        } = stats.opts || {};\n\n        const spreadMap = createSpreadMapper(path, stats);\n\n        attributes.forEach((attribute) => {\n          const destinationName = attributeNames[attribute.name.name];\n\n          const options = {\n            autoResolveMultipleImports,\n            handleMissingStyleName,\n          };\n\n          if (types.isStringLiteral(attribute.value)) {\n            resolveStringLiteral(\n              path,\n              styleMapsForFileByName[filename].styleModuleImportMap,\n              attribute,\n              destinationName,\n              options,\n            );\n          } else if (types.isJSXExpressionContainer(attribute.value)) {\n            if (!styleMapsForFileByName[filename].importedHelperIndentifier) {\n              setupFileForRuntimeResolution(path, filename);\n            }\n\n            replaceJsxExpressionContainer(\n              types,\n              path,\n              attribute,\n              destinationName,\n              styleMapsForFileByName[filename].importedHelperIndentifier,\n              types.cloneNode(styleMapsForFileByName[filename].styleModuleImportMapIdentifier),\n              options,\n            );\n          }\n\n          if (spreadMap[destinationName]) {\n            handleSpreadClassName(\n              path,\n              destinationName,\n              spreadMap[destinationName],\n            );\n          }\n        });\n      },\n\n      Program(path: typeof NodePath, stats: any): void {\n        if (!validate(stats.opts)) {\n          // eslint-disable-next-line no-console\n          console.error(validate.errors);\n\n          throw new Error('Invalid configuration');\n        }\n\n        const { filename } = stats.file.opts;\n\n        styleMapsForFileByName[filename] = {\n          styleModuleImportMap: {},\n        };\n        styleMapsForFileByPath[filename] = {};\n\n        if (stats.opts.skip && !attributeNameExists(path, stats)) {\n          skip = true;\n        }\n      },\n    },\n  };\n};\n"],"mappings":"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","ignoreList":[]}