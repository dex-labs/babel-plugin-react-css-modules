{"version":3,"file":"getLocalIdent.js","names":["_cssLoader","require","_TemplatedPathPlugin","_interopRequireDefault","_createHash","e","__esModule","default","getPath","mockCompilation","hooks","assetPath","tap","_","fn","mockCompiler","compilation","TemplatedPathPlugin","apply","filenameReservedRegex","reControlChars","regexSingleEscape","regexExcessiveSpaces","escape","string","output","counter","length","character","charAt","value","test","codePoint","charCodeAt","toString","toUpperCase","firstChar","slice","replace","aa","bb","cc","gobbleHex","lower","toLowerCase","hex","spaceTerminated","index","undefined","code","valid","Number","parseInt","isSurrogate","String","fromCodePoint","unescape","includes","returnValue","gobbled","exports","escapeLocalIdent","localident","getLocalIdent","loaderContext","localIdentName","localName","clazz","options","defaultGetLocalIdent","_compilation","_compiler","webpack","util","createHash","utils"],"sources":["../src/getLocalIdent.js"],"sourcesContent":["/**\n * getLocalIdent() function taken from css-loader@5.2.4\n */\n\nimport { defaultGetLocalIdent } from 'css-loader';\nimport TemplatedPathPlugin from 'webpack/lib/TemplatedPathPlugin';\nimport createHash from 'webpack/lib/util/createHash';\n\n/**\n * Interpolates path template according to data.\n *\n * NOTE: The current \"css-loader\" relies on Webpack compilation mechanics,\n * build around tappable plugins. Here we expose the core logic of Webpack's\n * TemplatePathPlugin to make it usable without hooks, and Webpack's compilation\n * object. This has pros and cons: on one hand it allows to easily keep our\n * plugin functional in a way it worked before, on the negative side it now\n * may be sensitive to the exact Webpack version, in addition to css-loader.\n * Overall, it seems a reasonable solution for now.\n *\n * @param {string} path\n * @param {object} data\n * @returns {string}\n */\nlet getPath;\n{\n  // NOTE: This codeblock just exploits the current implementation of underlying\n  // TemplatedPathPlugin, see:\n  // https://github.com/webpack/webpack/blob/7102df3bb52a33529ff5db4fdf34484d2a359a49/lib/TemplatedPathPlugin.js#L308-L319\n  // It just applies the plugin to mock compiler & compilation to get access to\n  // the core logic function, which is copied to getPath() to be reused directly\n  // when needed.\n  const mockCompilation = {\n    hooks: {\n      assetPath: {\n        tap: (_, fn) => {\n          getPath = fn;\n        },\n      },\n    },\n    tap: (_, fn) => {\n      fn(mockCompilation);\n    },\n  };\n  const mockCompiler = {\n    hooks: { compilation: mockCompilation },\n  };\n  new TemplatedPathPlugin().apply(mockCompiler);\n}\n\nconst filenameReservedRegex = /[\"*/:<>?\\\\|]/gu;\n// eslint-disable-next-line no-control-regex\nconst reControlChars = /[\\u0000-\\u001F\\u0080-\\u009F]/gu;\n\nconst regexSingleEscape = /[ -,./:-@[\\]^`{-~]/u;\nconst regexExcessiveSpaces = /(^|\\\\+)?(\\\\[\\dA-F]{1,6}) (?![\\d A-Fa-f])/gu;\n\nconst escape = (string) => {\n  let output = '';\n  let counter = 0;\n\n  while (counter < string.length) {\n    const character = string.charAt(counter++);\n\n    let value;\n\n    // eslint-disable-next-line no-control-regex\n    if (/[\\t\\n\\u000B\\f\\r]/u.test(character)) {\n      const codePoint = character.charCodeAt();\n\n      value = `\\\\${codePoint.toString(16).toUpperCase()} `;\n    } else if (character === '\\\\' || regexSingleEscape.test(character)) {\n      value = `\\\\${character}`;\n    } else {\n      value = character;\n    }\n\n    output += value;\n  }\n\n  const firstChar = string.charAt(0);\n\n  if (/^-[\\d-]/u.test(output)) {\n    output = `\\\\-${output.slice(1)}`;\n  } else if (/\\d/u.test(firstChar)) {\n    output = `\\\\3${firstChar} ${output.slice(1)}`;\n  }\n\n  // Remove spaces after `\\HEX` escapes that are not followed by a hex digit,\n  // since they’re redundant. Note that this is only possible if the escape\n  // sequence isn’t preceded by an odd number of backslashes.\n  output = output.replace(regexExcessiveSpaces, (aa, bb, cc) => {\n    if (bb && bb.length % 2) {\n      // It’s not safe to remove the space, so don’t.\n      return aa;\n    }\n\n    // Strip the space.\n    return (bb || '') + cc;\n  });\n\n  return output;\n};\n\nconst gobbleHex = (string) => {\n  const lower = string.toLowerCase();\n  let hex = '';\n  let spaceTerminated = false;\n\n  for (let index = 0; index < 6 && lower[index] !== undefined; index++) {\n    const code = lower.charCodeAt(index);\n\n    // check to see if we are dealing with a valid hex char [a-f|0-9]\n    const valid = (code >= 97 && code <= 102) || (code >= 48 && code <= 57);\n\n    // https://drafts.csswg.org/css-syntax/#consume-escaped-code-point\n    spaceTerminated = code === 32;\n\n    if (!valid) {\n      break;\n    }\n\n    hex += lower[index];\n  }\n\n  if (hex.length === 0) {\n    return undefined;\n  }\n\n  const codePoint = Number.parseInt(hex, 16);\n\n  const isSurrogate = codePoint >= 0xD8_00 && codePoint <= 0xDF_FF;\n\n  // Add special case for\n  // \"If this number is zero, or is for a surrogate,\n  // or is greater than the maximum allowed code point\"\n  // https://drafts.csswg.org/css-syntax/#maximum-allowed-code-point\n  if (isSurrogate || codePoint === 0x00_00 || codePoint > 0x10_FF_FF) {\n    return ['\\uFFFD', hex.length + (spaceTerminated ? 1 : 0)];\n  }\n\n  return [\n    String.fromCodePoint(codePoint),\n    hex.length + (spaceTerminated ? 1 : 0),\n  ];\n};\n\nexport const unescape = (string) => {\n  if (!string.includes('\\\\')) {\n    return string;\n  }\n\n  let returnValue = '';\n\n  for (let index = 0; index < string.length; index++) {\n    if (string[index] === '\\\\') {\n      const gobbled = gobbleHex(string.slice(index + 1, index + 7));\n\n      if (gobbled !== undefined) {\n        returnValue += gobbled[0];\n        index += gobbled[1];\n\n      // Retain a pair of \\\\ if double escaped `\\\\\\\\`\n      // https://github.com/postcss/postcss-selector-parser/commit/268c9a7656fb53f543dc620aa5b73a30ec3ff20e\n      } else if (string[index + 1] === '\\\\') {\n        returnValue += '\\\\';\n        index += 1;\n\n      // if \\\\ is at the end of the string retain it\n      // https://github.com/postcss/postcss-selector-parser/commit/01a6b346e3612ce1ab20219acc26abdc259ccefb\n      } else if (string.length === index + 1) {\n        returnValue += string[index];\n      }\n    } else returnValue += string[index];\n  }\n\n  return returnValue;\n};\n\nconst escapeLocalIdent = (localident) => escape(\n  localident\n\n  // For `[hash]` placeholder\n    .replace(/^((-?\\d)|--)/u, '_$1')\n    .replace(filenameReservedRegex, '-')\n    .replace(reControlChars, '-')\n    .replace(/\\./gu, '-'),\n);\n\nexport default function getLocalIdent(\n  loaderContext,\n  localIdentName,\n  localName,\n  { clazz, ...options },\n) {\n  return escapeLocalIdent(\n    defaultGetLocalIdent(\n      {\n        _compilation: { getPath },\n        _compiler: {\n          webpack: {\n            // This is required for css-loader@7+ compatibility because of:\n            // https://github.com/webpack-contrib/css-loader/blob/fd18587c1b6d689e3e3a3cc3e6c9fe52f5080181/src/utils.js#L331\n            util: { createHash },\n          },\n        },\n\n        // This is presumably required for backward compatibility with older\n        // css-loader versions.\n        utils: { createHash },\n\n        ...loaderContext,\n      },\n      localIdentName,\n      localName,\n      options,\n    ),\n  ).replace(/\\\\\\[local\\\\]/gi, clazz);\n}\n"],"mappings":"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","ignoreList":[]}